# ğŸ—ï¸ VimApp è¨­è¨ˆæ–¹é‡ãƒ»çµ±åˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ 2025

## ğŸ“‹ æ¦‚è¦

ã“ã®çµ±åˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã¯ã€VimApp ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­è¨ˆæ€æƒ³ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãŠã‚ˆã³å®Ÿè£…æŒ‡é‡ã‚’åŒ…æ‹¬çš„ã«ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚ä»Šå¾Œã®æ©Ÿèƒ½è¿½åŠ ã‚„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹è‡ªå‹•åŒ–é–‹ç™ºã«ãŠã„ã¦ã€ä¸€è²«æ€§ã®ã‚ã‚‹é«˜å“è³ªãªã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã®æŒ‡é‡ã¨ãªã‚Šã¾ã™ã€‚

---

## ğŸ¯ è¨­è¨ˆå“²å­¦

### æ ¸å¿ƒåŸå‰‡

#### 1. **ã‚·ãƒ³ãƒ—ãƒ«ã•è‡³ä¸Šä¸»ç¾©**

- **è¤‡é›‘æ€§ã‚ˆã‚Šã‚‚å¯èª­æ€§**: å·§å¦™ãªã‚³ãƒ¼ãƒ‰ã‚ˆã‚Šæ˜ç¢ºãªã‚³ãƒ¼ãƒ‰
- **æœ€å°é™ã®ä¾å­˜é–¢ä¿‚**: å¿…è¦æœ€å°é™ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½¿ç”¨
- **å˜ä¸€è²¬å‹™åŸå‰‡**: ä¸€ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»é–¢æ•°ã¯ä¸€ã¤ã®è²¬å‹™

#### 2. **å‹å®‰å…¨æ€§ã®å®Œå…¨å®Ÿè£…**

- **TypeScript strict mode**: å®Œå…¨ãªå‹ãƒã‚§ãƒƒã‚¯
- **å®Ÿè¡Œæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: Zod ã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹æ¤œè¨¼
- **å‹ã‚¬ãƒ¼ãƒ‰**: å®‰å…¨ãªå‹å¤‰æ›

#### 3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**

- **ãƒ¡ãƒ¢åŒ–æˆ¦ç•¥**: React.memo, useMemo, useCallback
- **é…å»¶èª­ã¿è¾¼ã¿**: Dynamic import, Suspense
- **æœ€å°ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°**: å¿…è¦ãªæ™‚ã®ã¿å†æç”»

#### 4. **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ»ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**

- **ARIA å±æ€§**: å®Œå…¨ãªæ”¯æ´æŠ€è¡“ã‚µãƒãƒ¼ãƒˆ
- **ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒã‚¦ã‚¹ä¸è¦ã®æ“ä½œ
- **ã‚«ãƒ©ãƒ¼ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ**: WCAG AA æº–æ‹ 

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ globals.css         # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ layout.tsx          # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ page.tsx            # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ providers.tsx       # ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â”‚   â”œâ”€â”€ theme.ts            # åŸºæœ¬ãƒ†ãƒ¼ãƒ
â”‚   â””â”€â”€ theme-v3.ts         # å¼·åŒ–ãƒ†ãƒ¼ãƒï¼ˆV3å¯¾å¿œï¼‰
â”‚
â”œâ”€â”€ components/             # React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ ui/                 # åŸºæœ¬UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ Button.tsx            # æ—¢å­˜ãƒœã‚¿ãƒ³
â”‚   â”‚   â”œâ”€â”€ Button-enhanced.tsx   # å¼·åŒ–ãƒœã‚¿ãƒ³
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ features/           # æ©Ÿèƒ½åˆ¥ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ VimEditor.tsx         # æ—¢å­˜ã‚¨ãƒ‡ã‚£ã‚¿
â”‚   â”‚   â”œâ”€â”€ VimEditor-enhanced.tsx # å¼·åŒ–ã‚¨ãƒ‡ã‚£ã‚¿
â”‚   â”‚   â”œâ”€â”€ CheatSheet.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ layouts/            # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚
â”œâ”€â”€ hooks/                  # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useVimEditor.ts           # æ—¢å­˜ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useVimEditor-enhanced.ts  # å¼·åŒ–ãƒ•ãƒƒã‚¯
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ types/                  # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ editor.ts
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ utils/                  # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”œâ”€â”€ editor.ts
â”‚   â”œâ”€â”€ storage.ts
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ constants/              # å®šæ•°ãƒ»è¨­å®š
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ design-system.ts
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ stores/                 # çŠ¶æ…‹ç®¡ç†ï¼ˆå°†æ¥çš„ï¼‰
    â””â”€â”€ ...
```

### ãƒ¬ã‚¤ãƒ¤ãƒ¼è²¬å‹™åˆ†é›¢

#### 1. **Presentation Layer (UI Components)**

```typescript
// âœ… è²¬å‹™: è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã®ã¿
const Component = ({ data, onAction }: Props) => {
  return (
    <Box>
      <Text>{data.title}</Text>
      <Button onClick={onAction}>Action</Button>
    </Box>
  );
};

// âŒ é¿ã‘ã‚‹ã¹ã: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’å«ã‚€
const Component = ({ id }: Props) => {
  const [data, setData] = useState();

  useEffect(() => {
    // ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°ï¼ˆåˆ¥ã®å±¤ã§è¡Œã†ã¹ãï¼‰
    fetchData(id).then(setData);
  }, [id]);

  return <div>{/* ... */}</div>;
};
```

#### 2. **Business Logic Layer (Custom Hooks)**

```typescript
// âœ… è²¬å‹™: çŠ¶æ…‹ç®¡ç†ã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
export function useDocumentEditor(initialDoc: Document) {
  const [doc, setDoc] = useState(initialDoc);
  const [isDirty, setIsDirty] = useState(false);

  const updateDoc = useCallback((content: string) => {
    setDoc((prev) => ({ ...prev, content }));
    setIsDirty(true);
  }, []);

  const saveDoc = useCallback(async () => {
    try {
      await saveToStorage(doc);
      setIsDirty(false);
    } catch (error) {
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
    }
  }, [doc]);

  return { doc, isDirty, updateDoc, saveDoc };
}
```

#### 3. **Data Access Layer (Utils)**

```typescript
// âœ… è²¬å‹™: ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ–ãƒ»å–å¾—
export const storageUtils = {
  async save<T>(key: string, data: T): Promise<void> {
    try {
      localStorage.setItem(key, JSON.stringify(data));
    } catch (error) {
      throw new StorageError("Failed to save data");
    }
  },

  async load<T>(key: string): Promise<T | null> {
    try {
      const item = localStorage.getItem(key);
      return item ? JSON.parse(item) : null;
    } catch (error) {
      throw new StorageError("Failed to load data");
    }
  },
};
```

---

## ğŸ¨ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ

### ãƒ†ãƒ¼ãƒã‚·ã‚¹ãƒ†ãƒ ã®ä½¿ç”¨

#### 1. **Chakra UI ãƒ†ãƒ¼ãƒã®æ´»ç”¨**

```typescript
// âœ… ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã®ä½¿ç”¨
const Component = () => (
  <Box
    bg="gray.900" // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ
    color="gray.100" // è‡ªå‹•ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆèª¿æ•´
    borderColor="gray.700" // ä¸€è²«ã—ãŸãƒœãƒ¼ãƒ€ãƒ¼
  >
    Content
  </Box>
);

// âŒ é¿ã‘ã‚‹ã¹ã: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå€¤
const Component = () => (
  <Box
    bg="#111827" // å›ºå®šå€¤ã¯NG
    color="#f3f4f6" // ãƒ†ãƒ¼ãƒå¤‰æ›´ã«å¯¾å¿œã§ããªã„
    borderColor="#374151" // ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ä½ä¸‹
  >
    Content
  </Box>
);
```

#### 2. **ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®æ´»ç”¨**

```typescript
import { DESIGN_SYSTEM } from "@/constants/design-system";

// âœ… çµ±ä¸€ã•ã‚ŒãŸãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³
const styles = {
  spacing: DESIGN_SYSTEM.spacing.md,
  color: DESIGN_SYSTEM.colors.accent.primary,
  borderRadius: DESIGN_SYSTEM.borders.radius.lg,
};

// âŒ å€‹åˆ¥ã®å€¤å®šç¾©
const styles = {
  spacing: "1.5rem", // çµ±ä¸€æ€§æ¬ å¦‚
  color: "#ff6b35", // è‰²ã®ä¸€è²«æ€§ãªã—
  borderRadius: "0.5rem", // ã‚¹ã‚±ãƒ¼ãƒ«æ„Ÿã®å–ªå¤±
};
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. **åˆæˆå¯èƒ½ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

```typescript
// âœ… å°ã•ãªéƒ¨å“ã‹ã‚‰å¤§ããªæ©Ÿèƒ½ã‚’æ§‹ç¯‰
const EditorToolbar = () => (
  <Flex gap={2}>
    <EditorActionButton onClick={onSave}>Save</EditorActionButton>
    <EditorActionButton onClick={onClear}>Clear</EditorActionButton>
    <EditorPrimaryButton onClick={onReset}>Reset</EditorPrimaryButton>
  </Flex>
);

// âŒ ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const EditorToolbar = ({
  onSave,
  onClear,
  onReset,
  showSave,
  showClear,
  showReset,
  saveLabel,
  clearLabel,
  resetLabel,
}: ComplexProps) => (
  <Flex gap={2}>
    {showSave && <Button onClick={onSave}>{saveLabel}</Button>}
    {showClear && <Button onClick={onClear}>{clearLabel}</Button>}
    {showReset && <Button onClick={onReset}>{resetLabel}</Button>}
  </Flex>
);
```

#### 2. **å‹å®‰å…¨ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­è¨ˆ**

```typescript
// âœ… å³å¯†ãªå‹å®šç¾©
interface ButtonProps {
  variant: "solid" | "ghost" | "outline";
  size: "xs" | "sm" | "md" | "lg";
  isLoading?: boolean;
  isDisabled?: boolean;
  children: React.ReactNode;
  onClick?: () => void;
}

// âŒ æ›–æ˜§ãªå‹å®šç¾©
interface ButtonProps {
  style?: string; // ä½•ã§ã‚‚å—ã‘å…¥ã‚Œã‚‹ã¯å±é™º
  config?: any; // anyå‹ã¯å‹å®‰å…¨æ€§ã‚’å¤±ã†
  options?: object; // å…·ä½“çš„ã§ãªã„
}
```

---

## ğŸ”§ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯è¨­è¨ˆ

#### 1. **è²¬å‹™ã®æ˜ç¢ºåŒ–**

```typescript
// âœ… å˜ä¸€è²¬å‹™ã®ãƒ•ãƒƒã‚¯
export function useLocalStorage<T>(key: string, defaultValue: T) {
  // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ“ä½œã®ã¿ã«ç‰¹åŒ–
}

export function useDebounce<T>(value: T, delay: number) {
  // ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ã®ã¿ã«ç‰¹åŒ–
}

export function useVimEditor() {
  // Vimã‚¨ãƒ‡ã‚£ã‚¿çŠ¶æ…‹ç®¡ç†ã®ã¿ã«ç‰¹åŒ–
}

// âŒ å¤šé‡è²¬å‹™ã®ãƒ•ãƒƒã‚¯
export function useEverything() {
  // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã€ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã€APIã€UIçŠ¶æ…‹...
  // è²¬å‹™ãŒä¸æ˜ç¢º
}
```

#### 2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®çµ±ä¸€**

```typescript
// âœ… ä¸€è²«ã—ãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
export function useAsyncOperation<T>() {
  const [state, setState] = useState<{
    data: T | null;
    error: Error | null;
    loading: boolean;
  }>({
    data: null,
    error: null,
    loading: false,
  });

  const execute = useCallback(async (operation: () => Promise<T>) => {
    setState((prev) => ({ ...prev, loading: true, error: null }));
    try {
      const data = await operation();
      setState({ data, error: null, loading: false });
    } catch (error) {
      setState({ data: null, error: error as Error, loading: false });
    }
  }, []);

  return { ...state, execute };
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³

#### 1. **ãƒ¡ãƒ¢åŒ–æˆ¦ç•¥**

```typescript
// âœ… é©åˆ‡ãªãƒ¡ãƒ¢åŒ–
const ExpensiveComponent = memo(({ data, onAction }: Props) => {
  const processedData = useMemo(
    () => expensiveCalculation(data),
    [data] // ä¾å­˜é…åˆ—ã‚’æ˜ç¢ºã«
  );

  const handleAction = useCallback(
    (id: string) => onAction(id),
    [onAction] // ä¾å­˜é–¢ä¿‚ã‚’æœ€å°é™ã«
  );

  return <div>{/* ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */}</div>;
});

// âŒ éåº¦ãªãƒ¡ãƒ¢åŒ–
const SimpleComponent = memo(({ text }: { text: string }) => {
  // ã‚·ãƒ³ãƒ—ãƒ«ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«memoã¯ä¸è¦
  return <Text>{text}</Text>;
});
```

#### 2. **ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–**

```typescript
// âœ… ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æœ€é©åŒ–
const ListComponent = ({ items }: { items: Item[] }) => {
  return (
    <VirtualizedList
      items={items}
      renderItem={({ item }) => <ItemComponent key={item.id} item={item} />}
    />
  );
};

// âŒ éåŠ¹ç‡ãªãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
const ListComponent = ({ items }: { items: Item[] }) => {
  return (
    <div>
      {items.map((item) => (
        <ItemComponent
          key={item.id}
          item={item}
          // æ¯å›æ–°ã—ã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆï¼ˆReact.memoãŒç„¡åŠ¹åŒ–ï¼‰
          style={{ marginBottom: "1rem" }}
        />
      ))}
    </div>
  );
};
```

---

## ğŸ›¡ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

### ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã®å®Ÿè£…

#### 1. **ã‚°ãƒ¬ãƒ¼ã‚¹ãƒ•ãƒ«ãƒ‡ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**

```typescript
// âœ… ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const EditorErrorBoundary = ({ children }: { children: React.ReactNode }) => {
  const { error, reportError, clearError } = useErrorBoundary();

  if (error) {
    return (
      <Alert status="error">
        <AlertIcon />
        <Box>
          <AlertTitle>ã‚¨ãƒ‡ã‚£ã‚¿ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</AlertTitle>
          <AlertDescription>{error.error.message}</AlertDescription>
        </Box>
        <Button onClick={clearError} ml={4}>
          å†è©¦è¡Œ
        </Button>
      </Alert>
    );
  }

  return <>{children}</>;
};
```

#### 2. **ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒ†ã‚£ãƒ³ã‚°**

```typescript
// âœ… æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ
interface ErrorReport {
  error: {
    code: string;
    message: string;
    timestamp: Date;
    stack?: string;
    context?: Record<string, unknown>;
  };
  severity: "low" | "medium" | "high" | "critical";
  recovery?: () => void;
}

export function useErrorReporting() {
  const reportError = useCallback((error: Error, severity: ErrorSeverity) => {
    const report: ErrorReport = {
      error: {
        code: error.name,
        message: error.message,
        timestamp: new Date(),
        stack: error.stack,
        context: {
          userAgent: navigator.userAgent,
          url: window.location.href,
        },
      },
      severity,
    };

    // é–‹ç™ºç’°å¢ƒã§ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›
    if (process.env.NODE_ENV === "development") {
      console.error("Error Report:", report);
    }

    // æœ¬ç•ªç’°å¢ƒã§ã¯å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡
    if (process.env.NODE_ENV === "production") {
      sendToErrorService(report);
    }
  }, []);

  return { reportError };
}
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆã‚«ãƒ†ã‚´ãƒª

#### 1. **å˜ä½“ãƒ†ã‚¹ãƒˆ (Unit Tests)**

```typescript
// âœ… ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
import { renderHook, act } from "@testing-library/react";
import { useLocalStorage } from "../hooks/useLocalStorage";

describe("useLocalStorage", () => {
  beforeEach(() => {
    localStorage.clear();
  });

  it("should return default value when storage is empty", () => {
    const { result } = renderHook(() => useLocalStorage("test-key", "default"));

    expect(result.current[0]).toBe("default");
  });

  it("should save and retrieve values", () => {
    const { result } = renderHook(() => useLocalStorage("test-key", "default"));

    act(() => {
      result.current[1]("new value");
    });

    expect(result.current[0]).toBe("new value");
    expect(localStorage.getItem("test-key")).toBe('"new value"');
  });
});
```

#### 2. **çµ±åˆãƒ†ã‚¹ãƒˆ (Integration Tests)**

```typescript
// âœ… ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçµ±åˆãƒ†ã‚¹ãƒˆ
import { render, screen, fireEvent } from "@testing-library/react";
import { ChakraProvider } from "@chakra-ui/react";
import VimEditor from "../components/VimEditor-enhanced";

const TestWrapper = ({ children }: { children: React.ReactNode }) => (
  <ChakraProvider>{children}</ChakraProvider>
);

describe("VimEditor Integration", () => {
  it("should switch modes correctly", async () => {
    render(<VimEditor onCodePenModeChange={jest.fn()} />, {
      wrapper: TestWrapper,
    });

    const htmlTab = screen.getByRole("tab", { name: /html/i });
    const cssTab = screen.getByRole("tab", { name: /css/i });

    fireEvent.click(cssTab);

    expect(cssTab).toHaveAttribute("aria-pressed", "true");
    expect(htmlTab).toHaveAttribute("aria-pressed", "false");
  });
});
```

#### 3. **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ**

```typescript
// âœ… a11y ãƒ†ã‚¹ãƒˆ
import { axe, toHaveNoViolations } from "jest-axe";

expect.extend(toHaveNoViolations);

describe("Accessibility", () => {
  it("should not have accessibility violations", async () => {
    const { container } = render(
      <VimEditor onCodePenModeChange={jest.fn()} />,
      { wrapper: TestWrapper }
    );

    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```

---

## ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¦ç´„

### ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´„

#### 1. **JSDoc ã‚³ãƒ¡ãƒ³ãƒˆ**

````typescript
/**
 * Enhanced Button Component with type-safe variants
 *
 * @example
 * ```tsx
 * <Button variant="solid" size="md" onClick={handleClick}>
 *   Click me
 * </Button>
 * ```
 *
 * @param variant - Visual style variant
 * @param size - Button size
 * @param children - Button content
 * @param onClick - Click handler
 * @returns React component
 */
export const Button = forwardRef<HTMLButtonElement, ButtonProps>(
  ({ variant = "solid", size = "md", children, onClick, ...props }, ref) => {
    // Implementation
  }
);
````

#### 2. **å®Ÿè£…ã‚³ãƒ¡ãƒ³ãƒˆ**

```typescript
// âœ… æ„å›³ã‚’èª¬æ˜ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆ
const useDebounce = <T>(value: T, delay: number): T => {
  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ãŸã‚ã€é »ç¹ãªæ›´æ–°ã‚’ãƒ‡ãƒã‚¦ãƒ³ã‚¹
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    // ã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®šã—ã€é…å»¶å¾Œã«å€¤ã‚’æ›´æ–°
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—é–¢æ•°ã§ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã‚’é˜²æ­¢
    return () => clearTimeout(handler);
  }, [value, delay]);

  return debouncedValue;
};

// âŒ è‡ªæ˜ãªã‚³ãƒ¡ãƒ³ãƒˆ
const add = (a: number, b: number): number => {
  // aã¨bã‚’è¶³ã—ç®—ã™ã‚‹
  return a + b;
};
```

### README è¦ç´„

#### 1. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ README**

```markdown
# Button Enhanced Component

## æ¦‚è¦

å‹å®‰å…¨ã§ä¸€è²«ã—ãŸ UI ã‚’æä¾›ã™ã‚‹å¼·åŒ–ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

## ä½¿ç”¨æ–¹æ³•

\`\`\`tsx
import { Button } from '@/components/ui/Button-enhanced'

const App = () => (
<Button variant="solid" size="md" onClick={handleClick}>
Click me
</Button>
)
\`\`\`

## Props

| Prop    | Type          | Default | Description      |
| ------- | ------------- | ------- | ---------------- |
| variant | ButtonVariant | 'solid' | ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« |
| size    | ButtonSize    | 'md'    | ãƒœã‚¿ãƒ³ã®ã‚µã‚¤ã‚º   |

## Variants

- `solid`: ãƒ—ãƒ©ã‚¤ãƒãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- `ghost`: ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- `outline`: ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ»CI/CD

### ãƒ“ãƒ«ãƒ‰æœ€é©åŒ–

#### 1. **Next.js è¨­å®š**

```javascript
// next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  experimental: {
    optimizeCss: true,
    optimizePackageImports: ["@chakra-ui/react"],
  },

  // ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
  webpack: (config, { dev, isServer }) => {
    if (!dev && !isServer) {
      config.optimization = {
        ...config.optimization,
        splitChunks: {
          chunks: "all",
          cacheGroups: {
            vendor: {
              test: /[\\/]node_modules[\\/]/,
              name: "vendors",
              chunks: "all",
            },
          },
        },
      };
    }
    return config;
  },
};

export default nextConfig;
```

#### 2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**

```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
export function usePerformanceMetrics() {
  useEffect(() => {
    // Core Web Vitals ç›£è¦–
    const observer = new PerformanceObserver((list) => {
      list.getEntries().forEach((entry) => {
        if (entry.entryType === "largest-contentful-paint") {
          console.log("LCP:", entry.startTime);
        }
        if (entry.entryType === "first-input") {
          console.log("FID:", entry.processingStart - entry.startTime);
        }
        if (entry.entryType === "layout-shift") {
          console.log("CLS:", entry.value);
        }
      });
    });

    observer.observe({
      entryTypes: ["largest-contentful-paint", "first-input", "layout-shift"],
    });

    return () => observer.disconnect();
  }, []);
}
```

---

## ğŸ“Š ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ç›£è¦–

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

#### 1. **Core Web Vitals**

- **LCP (Largest Contentful Paint)**: < 2.5 ç§’
- **FID (First Input Delay)**: < 100ms
- **CLS (Cumulative Layout Shift)**: < 0.1

#### 2. **é–‹ç™ºè€…ä½“é¨“æŒ‡æ¨™**

- **TypeScript ã‚¨ãƒ©ãƒ¼**: 0 ä»¶
- **ESLint ãƒ¯ãƒ¼ãƒ‹ãƒ³ã‚°**: 0 ä»¶
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: > 80%
- **ãƒ“ãƒ«ãƒ‰æ™‚é–“**: < 30 ç§’

#### 3. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“æŒ‡æ¨™**

- **ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚é–“**: < 1 ç§’
- **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–æ™‚é–“**: < 2 ç§’
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢**: AAA

---

## ğŸ”„ ç¶™ç¶šçš„æ”¹å–„

### å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹

#### 1. **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

- [ ] TypeScript å‹å®‰å…¨æ€§
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
- [ ] ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

#### 2. **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ¬ãƒ“ãƒ¥ãƒ¼**

- **æœˆæ¬¡**: æŠ€è¡“è² å‚µã®ç‰¹å®šã¨å¯¾å¿œ
- **å››åŠæœŸ**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è©•ä¾¡
- **å¹´æ¬¡**: æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è¦‹ç›´ã—

#### 3. **æ”¹å–„ææ¡ˆãƒ—ãƒ­ã‚»ã‚¹**

```markdown
## æ”¹å–„ææ¡ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### å•é¡Œã®èª¬æ˜

ç¾åœ¨ã®å•é¡Œç‚¹ã‚’å…·ä½“çš„ã«è¨˜è¿°

### ææ¡ˆã™ã‚‹è§£æ±ºç­–

å…·ä½“çš„ãªå®Ÿè£…æ¡ˆã¨ãƒ¡ãƒªãƒƒãƒˆ

### å½±éŸ¿ç¯„å›²

å¤‰æ›´ã«ã‚ˆã‚‹å½±éŸ¿ç¯„å›²ã®åˆ†æ

### å®Ÿè£…è¨ˆç”»

æ®µéšçš„ãªå®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
```

---

## ğŸ’¡ ã¾ã¨ã‚

### æˆåŠŸã®éµ

1. **ä¸€è²«æ€§**: çµ±ä¸€ã•ã‚ŒãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãƒ«ãƒ¼ãƒ«ã®å³å®ˆ
2. **å‹å®‰å…¨æ€§**: TypeScript ã®åŠ›ã‚’æœ€å¤§é™æ´»ç”¨
3. **ãƒ†ã‚¹ãƒˆé§†å‹•**: å“è³ªä¿è¨¼ã®è‡ªå‹•åŒ–
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: çŸ¥è­˜ã®ç¶™æ‰¿ã¨å…±æœ‰
5. **ç¶™ç¶šæ”¹å–„**: å®šæœŸçš„ãªè¦‹ç›´ã—ã¨æœ€é©åŒ–

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®æ®µéšçš„ç§»è¡Œ**: ãƒ¬ã‚¬ã‚·ãƒ¼ã‹ã‚‰æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³ã¸
2. **è‡ªå‹•åŒ–ã®å¼·åŒ–**: ãƒ†ã‚¹ãƒˆãƒ»ãƒªãƒ³ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã®è‡ªå‹•åŒ–
3. **ç›£è¦–ä½“åˆ¶ã®æ§‹ç¯‰**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ã‚¨ãƒ©ãƒ¼ã®å¸¸æ™‚ç›£è¦–
4. **ãƒãƒ¼ãƒ æ•™è‚²**: æ–°ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å…±æœ‰ã¨æ™®åŠ

ã“ã®çµ±åˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã«å¾“ã†ã“ã¨ã§ã€VimApp ã¯é•·æœŸçš„ã«ä¿å®ˆå¯èƒ½ã§æ‹¡å¼µæ€§ã®é«˜ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æˆé•·ã—ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
